<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>My Project: Unicode</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Unicode </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This library contains modules for efficient lexical operations on Unicode strings to support simple generation of DSL (Domain Specific Languages). A dynamic library is generated. Unit tests exercise most of the functionality. Mostly, the DRY principle has been followed. More work is needed in two directions:</p><ul>
<li>More unit tests (including failure modes)</li>
<li>TDD Implement <a class="el" href="class_tree.html" title="Create an O(1) association between codepoint and indices. ">Tree</a> functionality.</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;html                doxygen output directory</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;latex               doxygen output directory</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;.gitignore          patterns of intermediate files not to be stored on github</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Doxyfile            control for doxygen production</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;LICENSE             (GPLv3)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;LinkDefs.h          common root of doxygen</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;Makefile            control for production of this resource</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;Node.cpp            O(1) dictionary translating Codepoints to Tablenumbers</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;Node.h              interface</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;README.md           this file</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;Tree.cpp            O(N) dictionary translating u32strings to Canonical Lists</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;Tree.h              interface</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;Unicode.h           primitives (including inline UTF8/codepoint translations)</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;haiku.utf8.cpp      copy of what test_Unicode is to produce (for comparison)</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;haiku.utf8.txt      102 language to test UTF8/codepoint conversions</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;test_Node.cpp       unit tests</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;test_Tree.cpp       unit tests</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;test_Unicode.cpp    unit tests</div>
</div><!-- fragment --><h2>Requirements:</h2>
<ul>
<li>g++ (gnu c++ compiler) supporting the -std=c++11 flag</li>
<li>cpplint</li>
<li>valgrind</li>
<li>doxygen</li>
</ul>
<h2>Build:</h2>
<ul>
<li>make clean; clear; make</li>
</ul>
<h2>Theory:</h2>
<p>Dictionary lookup typically incurs a cost of calculating the hash followed by disambiguating the hash bucket. Both of these calculations can be expensive. The cost is fixed for hash tables with no collisions.</p>
<p><a class="el" href="class_node.html" title="Create an O(1) association between codepoint and indices. ">Node</a> and <a class="el" href="class_tree.html" title="Create an O(1) association between codepoint and indices. ">Tree</a> are alternative algorithms for guaranteeing low fixed cost dictionary operations on simple Unicode codepoints (<a class="el" href="class_node.html" title="Create an O(1) association between codepoint and indices. ">Node</a>) and simple Unicode codepoint strings (<a class="el" href="class_tree.html" title="Create an O(1) association between codepoint and indices. ">Tree</a>).</p>
<h3>Observations supporting the <a class="el" href="class_node.html" title="Create an O(1) association between codepoint and indices. ">Node</a> implementation:</h3>
<p>Codepoints have 21 significant bits. Observe letter B converted to indices. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;B</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;0042                          hexadecimal</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;000000000000001000010         binary</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;000 000 000 000 001 000 010   7 groups of 3</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;a=0 b=0 c=0 d=0 e=1 f=0 g=2   position labels and indices</div>
</div><!-- fragment --><p>Lookup is performed by multiple table dereferences to get new indices. The code for getting an association for a codepoint is: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;((codepoint&gt;&gt;(n*3))&amp;0xf) where a uses n==0, b uses n==1, etc...</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;lookup(codepoint) { return T[T[T[T[T[T[T[1][g]][f]][e]][d]][c]][b]][a] }</div>
</div><!-- fragment --><ul>
<li>7 multiplies # Can be eliminated by manifest constants</li>
<li>7 shifts</li>
<li>7 masks</li>
<li>8 table dereferences</li>
<li>29 total machine code operations in original iAPX86 8088 instructions</li>
<li>operation count may be less for more recent processors</li>
<li>memory consumption per layer is 32 bytes</li>
</ul>
<p>Consider all the values to be hexadecimal. The initial table index is 1 because index 0 is used to flag errors. Suppose we want to associate the codepoint for letter 'B' with its codepoint. In other words, this lookup will be the identity function lookup(42) = 42. We will restrict the hex representation to 16 bits for visual ease. Keep in mind that the full width is 21. We start by building a table T with the following contents: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;B</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;0042</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;000000000000001000011</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;000 000 000 000 001 000 010</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;a=0 b=0 c=0 d=0 e=1 f=0 g=2</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;T = [</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; [0000 0000 0000 0000 0000 0000 0000 0000]  # &lt;- error layer (all zeros always)</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; [0002 0000 0000 0000 0000 0000 0000 0000]  # &lt;- starting index for lookup</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; [0003 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; [0004 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; [0005 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; [0000 0006 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; [0007 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; [0000 0000 0042 0000 0000 0000 0000 0000]  # &lt;- layer containing association</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;]</div>
</div><!-- fragment --><p>Illustration of sequential dereferencing. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;T[1][a] yields 2 then</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;T[2][b] yields 3 then</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;T[3][c] yields 4 then</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;T[4][d] yields 5 then</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;T[5][e] yields 6 then</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;T[6][f] yields 7 then</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;T[7][g] yields 42  # The association</div>
</div><!-- fragment --><p>If we want to add an association for 'C' the table will look like this: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;C</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;0043</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;000000000000001000011</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;000 000 000 000 001 000 011</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;a=0 b=0 c=0 d=0 e=1 f=0 g=3</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;T = [</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; [0000 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; [0002 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; [0003 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; [0004 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; [0005 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; [0000 0006 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; [0007 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; [0000 0000 0042 0043 0000 0000 0000 0000] # &lt;- table 8 has 0043 at offset 3</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;]</div>
</div><!-- fragment --><p> Note how no layers were added to support 'C'.</p>
<p>If we want to add an association for 'L' the table will look like this. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;L</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;004C</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;000000000000001001100</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;000 000 000 000 001 001 100</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;a=0 b=0 c=0 d=0 e=1 f=1 g=4</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;T = [</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; [0000 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; [0002 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; [0003 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; [0004 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; [0005 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; [0000 0006 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; [0007 0008 0000 0000 0000 0000 0000 0000] # &lt;- see the addition of table 8</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; [0000 0000 0042 0043 0000 0000 0000 0000]</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; [0000 0000 0000 0000 004C 0000 0000 0000] # &lt;- table 8 has 004C at offset 4</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;]</div>
</div><!-- fragment --><p>Now, let's add the Chinese character for mountain U+5C71 </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;山</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;5C71</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;000000101110001110001 </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;000 000 101 110 001 110 001</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;a=0 b=0 c=5 d=6 e=1 f=6 g=1</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;T = [</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; [0000 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; [0002 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; [0003 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; [0004 0000 0000 0000 0000 0009 0000 0000] # &lt;- see the addition of table 9</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160; [0005 0000 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; [0000 0006 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; [0007 0008 0000 0000 0000 0000 0000 0000]</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; [0000 0000 0042 0043 0000 0000 0000 0000]</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; [0000 0000 0000 0000 004C 0000 0000 0000]</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; [0000 0000 0000 0000 0000 0000 000A 0000] # &lt;- see the addition of table A</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; [0000 000B 0000 0000 0000 0000 0000 0000] # &lt;- see the addition of table B</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; [0000 0000 0000 0000 0000 0000 000C 0000] # &lt;- see the addition of table C</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; [0000 000D 0000 0000 0000 0000 0000 0000] # &lt;- see the addition of table D</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; [0000 5C71 0000 0000 0000 0000 0000 0000] # &lt;- table D has 5C71 at offset 1</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;]</div>
</div><!-- fragment --><p>Illustration of sequential dereferencing for that Chinese character. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;T[1][a] yields 2 then</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;T[2][b] yields 3 then</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;T[3][c] yields 9 then</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;T[4][d] yields A then</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;T[5][e] yields B then</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;T[6][f] yields C then</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;T[7][g] yields 5C71  # The association</div>
</div><!-- fragment --><p>Using 3 groups of 7, the operation count drops to 17 and the memory consumption per layer is 512 bytes.</p>
<p>7 groups of 3 may look a bit inefficient with space, but 3 groups of 7 would be worse. The total consumed here by 7 groups of 3 is 14 * 32 = 448 butes. For 3 groups of 7 this would be 6 * 512 = 3017 bytes. 7 groups of 3 increases the calculation time by 7/3 or 2.3333... We choose to trade speed for space. These representations can be stored and recovered from disk.</p>
<p>Summary:</p><ul>
<li>Codepoints are intrinsically 21 bits.</li>
<li>21 is the product 3 * 7.</li>
<li>3 groups of 7 bits or 7 groups of 3 bits will fit a codepoint perfectly.</li>
<li>a 32 bit internal codepoint or index occupies 4 bytes.</li>
<li>3 bits supports 8 indices while 7 bits supports 128 indices.</li>
<li>7 groups of 3 is used because the table layer size is small (32 bytes).</li>
<li>The initial association costs 8 * 32 = 256 bytes.</li>
<li>Subsequent associations in-layer cost 0 additional bytes.</li>
<li>Subsequent associations out-of-layer cost at least one final layer each.</li>
<li>Worst case cost (i.e. 0x10FFF) costs 6 additional layers.</li>
</ul>
<h3>Special Notes:</h3>
<p>0x10FFFF is used as a sentinel in the code as the highest legal codepoint. This is permitted for two reasons, it enables detection of some errors, and it is documented to never be transmitted and is declared a nonchar.</p>
<h2><a class="el" href="_unicode_8h_source.html">Unicode.h</a>: Shared resources</h2>
<ul>
<li>Output function for tables</li>
<li>Input conversion from unsigned UTF8 bytes char32_t internal codepoints.</li>
<li>Output conversion from char32_t internal codepoints to unsigned UTF8 bytes.</li>
</ul>
<p>This implementation eliminates function calls and branch points. Data flows through a table of computed gotos for translations both ways.</p>
<h2><a class="el" href="class_node.html" title="Create an O(1) association between codepoint and indices. ">Node</a>: an O(1) state transition mechanism</h2>
<p><a class="el" href="class_node.html" title="Create an O(1) association between codepoint and indices. ">Node</a> acts as an O(1) dictionary to translate Unicode Codepoints or Unicode Codepoint classifications into table numbers. This enables rapid state machine operations.</p>
<h2><a class="el" href="class_tree.html" title="Create an O(1) association between codepoint and indices. ">Tree</a>: an O(N) token lookup mechanism</h2>
<p><a class="el" href="class_tree.html" title="Create an O(1) association between codepoint and indices. ">Tree</a> acts as an O(N) dictionary to identify and/or canonicalize valid Unicode tokens. It can be used to recognize keywords. It can also be used to identify tokens that are absent from the dictionary. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
